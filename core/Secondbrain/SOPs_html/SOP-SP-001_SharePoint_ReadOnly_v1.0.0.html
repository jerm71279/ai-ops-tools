<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>SOP-SP-001_SharePoint_ReadOnly_v1.0.0</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">SOP-SP-001_SharePoint_ReadOnly_v1.0.0</h1>
</header>
<h1 id="standard-operating-procedure-sop-sp-001">Standard Operating
Procedure: SOP-SP-001</h1>
<hr />
<h2
id="sop-sp-001-sharepoint-read-only-access-configuration">SOP-SP-001:
SharePoint Read-Only Access Configuration</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Document ID</strong></th>
<th style="text-align: left;"><strong>Version</strong></th>
<th style="text-align: left;"><strong>Effective Date</strong></th>
<th style="text-align: left;"><strong>Author</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SOP-SP-001</td>
<td style="text-align: left;">1.0</td>
<td style="text-align: left;">2025-12-02</td>
<td style="text-align: left;">Gemini Agent</td>
</tr>
</tbody>
</table>
<h3 id="purpose">1.0 Purpose</h3>
<p>To establish a standardized and secure procedure for configuring a
read-only Azure AD application. This application will grant the
OberaConnect Second Brain system access to download and process
documents from SharePoint. The procedure is designed to have zero impact
on existing user permissions, data integrity, or Microsoft 365
settings.</p>
<h3 id="scope">2.0 Scope</h3>
<p>This SOP applies to all Azure Administrators within OberaConnect who
are tasked with configuring data access for internal systems. This
procedure is strictly limited to the creation and configuration of the
<code>SecondBrain-ReadOnly-SharePoint</code> application.</p>
<h3 id="responsibilities">3.0 Responsibilities</h3>
<ul>
<li><strong>Azure Administrator:</strong> Responsible for executing all
steps outlined in this SOP, ensuring permissions are correctly
configured, and securely storing the generated credentials.</li>
</ul>
<h3 id="prerequisites">4.0 Prerequisites</h3>
<ul>
<li>Administrative access to the OberaConnect Azure Portal
(https://portal.azure.com).</li>
<li>Access to the server environment where the Second Brain application
is hosted to configure environment variables.</li>
</ul>
<h3 id="procedure">5.0 Procedure</h3>
<p>This procedure is divided into three main parts: App Registration in
Azure, local credential configuration, and connection testing.</p>
<h4 id="part-a-azure-app-registration">5.1 Part A: Azure App
Registration</h4>
<p><strong>5.1.1 Navigate to Azure App Registrations</strong> 1. Log in
to the <strong>Azure Portal</strong>: <a
href="https://portal.azure.com">https://portal.azure.com</a> 2. From the
left sidebar, select <strong>Azure Active Directory</strong>. 3. Select
<strong>App registrations</strong>. 4. Click <strong>+ New
registration</strong>.</p>
<p><strong>5.1.2 Register the Application</strong> 1. Fill in the
registration form with the following details: - <strong>Name:</strong>
<code>SecondBrain-ReadOnly-SharePoint</code> - <strong>Supported account
types:</strong> Select <strong>Accounts in this organizational directory
only (OberaConnect only - Single tenant)</strong>. - <strong>Redirect
URI:</strong> Leave this section blank. 2. Click the
<strong>Register</strong> button to create the application.</p>
<p><strong>5.1.3 Record Application Identifiers</strong> 1. After
registration, you will be on the app’s overview page. 2. Copy and
securely store the following values for use in Step 5.2: -
<code>Application (client) ID</code> -
<code>Directory (tenant) ID</code></p>
<p><strong>5.1.4 Create a Client Secret</strong> 1. From the left
sidebar, select <strong>Certificates &amp; secrets</strong>. 2. Click
<strong>+ New client secret</strong>. 3. Provide the following details:
- <strong>Description:</strong> <code>SecondBrain Read Access</code> -
<strong>Expires:</strong> <code>24 months</code> (or as per company
policy). 4. Click <strong>Add</strong>. 5. <strong>CRITICAL:</strong>
Immediately copy the <strong>Value</strong> of the client secret. This
value is only displayed once. Securely store it for use in Step 5.2.</p>
<p><strong>5.1.5 Grant Read-Only API Permissions</strong> 1. From the
left sidebar, select <strong>API permissions</strong>. 2. Click
<strong>+ Add a permission</strong>. 3. Select <strong>Microsoft
Graph</strong>. 4. Select <strong>Application permissions</strong>.
<strong>Do not use Delegated permissions.</strong> 5. In the “Select
permissions” search box, find and check the following permissions: -
<code>Sites.Read.All</code> - <code>Files.Read.All</code> 6.
<strong>VERIFY:</strong> Ensure no “Write,” “Manage,” or “FullControl”
permissions are added. This application must remain
<strong>READ-ONLY</strong>. 7. Click <strong>Add
permissions</strong>.</p>
<p><strong>5.1.6 Grant Admin Consent</strong> 1. On the API permissions
page, click the <strong>Grant admin consent for OberaConnect</strong>
button. 2. A confirmation prompt will appear. Click
<strong>Yes</strong>. 3. Verify that a green checkmark appears in the
“Status” column for both permissions.</p>
<h4 id="part-b-credential-configuration">5.2 Part B: Credential
Configuration</h4>
<ol type="1">
<li>Connect to the WSL/Linux system hosting the application.</li>
<li>Navigate to the project directory:
<code>bash     cd /path/to/project</code></li>
<li>Open the environment variable file for editing:
<code>bash     nano .env</code></li>
<li>Add the following lines to the file, replacing the placeholder text
with the values copied from steps 5.1.3 and 5.1.4:
<code>bash     # SharePoint Read-Only Access     AZURE_TENANT_ID=your-tenant-id-here     AZURE_CLIENT_ID=your-client-id-here     AZURE_CLIENT_SECRET=your-secret-value-here</code></li>
<li>Save the file and exit the editor (Ctrl+X, then Y, then Enter).</li>
</ol>
<h4 id="part-c-connection-testing">5.3 Part C: Connection Testing</h4>
<ol type="1">
<li>Ensure you are in the project directory:
<code>bash     cd /path/to/project</code></li>
<li>Execute the SharePoint importer script to test the connection:
<code>bash     ./venv/bin/python sharepoint_importer.py</code></li>
<li>A successful test will output a list of SharePoint sites, confirming
the credentials and permissions are correct.</li>
</ol>
<h3 id="security-compliance">6.0 Security &amp; Compliance</h3>
<ul>
<li><strong>Capabilities:</strong> The application is strictly limited
to reading SharePoint sites/libraries and downloading copies of files.
It can view file metadata.</li>
<li><strong>Restrictions:</strong> The application
<strong>CANNOT</strong> modify, delete, or create files in SharePoint.
It cannot alter permissions, access user data (e.g., email), or change
any Microsoft 365 settings.</li>
<li><strong>Isolation:</strong> This is a standalone app registration,
completely isolated from other OberaConnect Azure applications. It uses
its own credentials and permissions.</li>
</ul>
<h3 id="revocation-procedure">7.0 Revocation Procedure</h3>
<p>To revoke access for this application, perform the following steps:
1. Navigate to <strong>Azure Portal &gt; Azure Active Directory &gt; App
registrations</strong>. 2. Search for and select
<code>SecondBrain-ReadOnly-SharePoint</code>. 3. On the application
overview page, click <strong>Delete</strong>. 4. Confirm the deletion.
Access will be immediately and permanently revoked.</p>
<h3 id="verification-checklist">8.0 Verification Checklist</h3>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 30%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Verification Point</th>
<th style="text-align: center;">Completed (✔)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">App is named
<code>SecondBrain-ReadOnly-SharePoint</code>.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Permissions are <strong>Application
permissions</strong>, not Delegated.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Only <code>Sites.Read.All</code> and
<code>Files.Read.All</code> are granted.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">No write, manage, or full control
permissions are present.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Admin consent has been granted (green
checkmarks visible).</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Client ID, Tenant ID, and Client Secret
are copied correctly.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">Credentials have been securely added to
the <code>.env</code> file.</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">The connection test script
(<code>sharepoint_importer.py</code>) runs successfully.</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="troubleshooting">8.1 Troubleshooting</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="header">
<th>Issue</th>
<th>Cause</th>
<th>Resolution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“Insufficient privileges to complete the operation”</td>
<td>Admin consent not granted or not propagated</td>
<td>Go to API Permissions, click “Grant admin consent”. Wait 5-10
minutes for propagation.</td>
</tr>
<tr class="even">
<td>“Failed to get access token”</td>
<td>Incorrect credentials in <code>.env</code></td>
<td>Verify AZURE_TENANT_ID, AZURE_CLIENT_ID, and AZURE_CLIENT_SECRET are
correct. Check for extra spaces/characters.</td>
</tr>
<tr class="odd">
<td>“AADSTS700016: Application not found”</td>
<td>Wrong tenant ID or app deleted</td>
<td>Verify tenant ID matches your Azure AD. Check app registration still
exists.</td>
</tr>
<tr class="even">
<td>“The specified client secret has expired”</td>
<td>Client secret expired</td>
<td>Create new client secret in Azure Portal &gt; Certificates &amp;
secrets. Update <code>.env</code>.</td>
</tr>
<tr class="odd">
<td>“Access denied” to specific site</td>
<td>Site-level permissions restrict app access</td>
<td>App has tenant-wide read, but site admins can block. Check site
permissions or use delegated flow.</td>
</tr>
<tr class="even">
<td>Connection timeout</td>
<td>Network/firewall blocking Azure endpoints</td>
<td>Verify outbound HTTPS to <code>login.microsoftonline.com</code> and
<code>graph.microsoft.com</code>.</td>
</tr>
<tr class="odd">
<td>“Resource does not exist”</td>
<td>Wrong site ID or site deleted</td>
<td>Verify site ID using Graph Explorer:
<code>GET /sites?search=sitename</code>.</td>
</tr>
<tr class="even">
<td>Empty file list returned</td>
<td>No files in library or wrong drive ID</td>
<td>Verify drive ID. Check library has files. Try listing root:
<code>/drives/{drive-id}/root/children</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Diagnostic Commands:</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test authentication</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST <span class="st">&quot;https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token&quot;</span> <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&quot;client_id={client_id}&amp;scope=https://graph.microsoft.com/.default&amp;client_secret={secret}&amp;grant_type=client_credentials&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test Graph API access (with token)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer {token}&quot;</span> <span class="st">&quot;https://graph.microsoft.com/v1.0/sites&quot;</span></span></code></pre></div>
<p><strong>Python Test Script:</strong></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> azure.identity <span class="im">import</span> ClientSecretCredential</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> msgraph.core <span class="im">import</span> GraphClient</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>credential <span class="op">=</span> ClientSecretCredential(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    tenant_id<span class="op">=</span>os.getenv(<span class="st">&quot;AZURE_TENANT_ID&quot;</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    client_id<span class="op">=</span>os.getenv(<span class="st">&quot;AZURE_CLIENT_ID&quot;</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    client_secret<span class="op">=</span>os.getenv(<span class="st">&quot;AZURE_CLIENT_SECRET&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> GraphClient(credential<span class="op">=</span>credential)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> client.get(<span class="st">&#39;/sites&#39;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.json())</span></code></pre></div>
<hr />
<h3 id="revision-history">9.0 Revision History</h3>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>2025-12-02</td>
<td>Gemini Agent</td>
<td>Initial document creation.</td>
</tr>
<tr class="even">
<td>1.1</td>
<td>2025-12-29</td>
<td>Jeremy Smith</td>
<td>SME Review: Added Section 8.1 (Troubleshooting) with common Azure AD
app and Graph API issues. Added diagnostic commands.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="approval">10.0 Approval</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Signature</th>
<th style="text-align: left;">Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Document Owner</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Approved By</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</body>
</html>
